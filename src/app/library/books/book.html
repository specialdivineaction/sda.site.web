<section class="section--work layout-padding">
   <div class="work" ng-if="!vm.loading && vm.work">
      <h1><sda-work-title ng-model="vm.work.titles"></sda-work-title></h1>
      <p>by <sda-work-authors class="authors" ng-model="vm.work.authors"></sda-work-authors></p>

      <a class="work-copy readonline" ui-sref="sda.library.bookreader({workId: vm.work.id, editionId: null, volumeId: null, copyId: vm.work.copies[0].id})" ng-if="vm.work.copies.length > 0">
         <i class="fa fa-book"></i>
         <span class="sr-only">Read Volume {{volume.volumeNumber}} Online</span>
      </a>

      <section class="summary" ng-if="vm.work.summary" ng-bind-html="vm.work.summary"></section>

      <section class="editions" ng-if="vm.work.editions.length">
         <h2>Editions</h2>

         <div class="edition" ng-repeat="edition in vm.work.editions" ng-class="{active: edition.active}">
            <h3 ng-class="{active: edition.active}">
               <a class="edition-name" href="" ng-click="edition.active = !edition.active">{{edition.editionName || '[Untitled Edition]'}}</a>
               <a class="edition-copy readonline" ui-sref="sda.library.bookreader({workId: vm.work.id, editionId: edition.id, volumeId: null, copyId: edition.copies[0].id})" ng-if="edition.copies.length > 0">
                  <i class="fa fa-book"></i>
                  <span class="sr-only">Read online</span>
               </a>
            </h3>

            <div class="collapse" slide-toggle="edition.active">
               <p class="citation">
                  <sda-work-citation
                     authors="edition.authors"
                     titles="edition.titles"
                     publication-info="edition.publicationInfo">
                  </sda-work-citation>
               </p>

               <section class="summary" ng-if="edition.summary" ng-bind-html="edition.summary"></section>

               <section class="volumes" ng-if="edition.volumes.length">
                  <h4>Volumes</h4>
                  <div class="volume" ng-repeat="volume in edition.volumes" ng-class="{active: volume.active}">
                     <h5 ng-class="{active: volume.active}">
                        <a class="volume-number" href="" ng-click="volume.active = !volume.active">Volume {{volume.volumeNumber}}</a>
                        <a class="volume-copy readonline" ui-sref="sda.library.bookreader({workId: vm.work.id, editionId: edition.id, volumeId: volume.id, copyId: volume.copies[0].id})" ng-if="volume.copies.length > 0">
                           <i class="fa fa-book"></i>
                           <span class="sr-only">Read Volume {{volume.volumeNumber}} Online</span>
                        </a>
                     </h5>

                     <div class="collapse" slide-toggle="volume.active">
                        <p class="citation">
                           <sda-work-citation
                              authors="volume.authors"
                              titles="volume.titles"
                              edition="edition.editionName"
                              volume="'Volume ' + volume.volumeNumber"
                              publication-info="volume.publicationInfo">
                           </sda-work-citation>
                        </p>

                        <div class="summary" ng-if="volume.summary" ng-bind-html="volume.summary"></div>
                     </div>
                  </div>
               </section>
            </div>
         </div>
      </section>

      <section class="related" ng-if="vm.relationships.length">
         <h2>Related Works</h2>
         <ul>
            <li ng-repeat="relationship in vm.relationships">
               <!-- HACK: relies on the fact that works, editions, and volumes look similar -->
               <span class="relationship">{{relationship.title}}</span>
               <sda-work-citation
                  work-id="relationship.entity.id"
                  authors="relationship.entity.authors"
                  titles="relationship.entity.titles"
                  edition="relationship.edition.editionName"
                  volume="relationship.volume.volumeNumber"
                  publication-info="relationship.entity.publicationInfo">
               </sda-work-citation>
            </li>
         </ul>
      </section>
   </div>

   <div class="throbber" ng-if="vm.loading && vm.showThrobber">
      <i class="fa fa-spin fa-circle-o-notch"></i>
   </div>
</section>
